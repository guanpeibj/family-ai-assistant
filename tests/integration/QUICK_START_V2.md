# FAA 测试系统 V2 - 5分钟快速上手

## 🚀 立即开始

### 1. 运行第一个测试（30秒）

```bash
cd /Users/guanpei/Develop/family-ai-assistant
python tests/integration/test_p0_accounting_v2.py
```

**你会看到**：
- ✅ 每个测试的详细评分（数据层、智能层、体验层）
- 📊 最终总结（通过率、平均分）
- 💡 改进建议

### 2. 快速验证功能（2分钟）

```bash
# 运行10个核心测试用例
python tests/integration/run_golden_set.py --limit 10
```

**结果**：
- 10个用例 × 平均10秒 = 约2分钟
- 成本：约$0.35
- 快速验证核心功能是否正常

### 3. 完整测试（15分钟）

```bash
# 运行完整黄金测试集（50个用例）
python tests/integration/run_golden_set.py
```

**结果**：
- 50个用例 × 平均12秒 = 约10-15分钟
- 成本：约$1.65
- 生成完整报告：`reports/golden_*.json`

### 4. AB测试对比（5分钟）

```bash
# 对比两个Prompt版本
python tests/integration/run_ab_test.py \
  --variant-a '{"name":"A"}' \
  --variant-b '{"name":"B"}' \
  --limit 20
```

**结果**：
- 自动对比两个版本
- 给出推荐和理由
- 成本：约$2.00

---

## 📊 核心概念（1分钟理解）

### 三层验证 = 100分

```
数据层 (40分) → AI做对了吗？（数据库查询）
智能层 (40分) → AI聪明吗？（AI评估AI）
体验层 (20分) → AI好用吗？（AI评估AI）
```

### 评分标准

- **60分及格** - 单个测试
- **70分及格** - 测试套件平均分
- **80分及格** - 黄金测试集（高标准）

### 通过标准

- **通过率≥80%** - 测试套件
- **通过率≥90%** - 黄金测试集

---

## 🎯 常用命令

```bash
# 快速验证（开发时用）
python tests/integration/run_golden_set.py --limit 10

# 完整测试（提交前用）
python tests/integration/run_golden_set.py

# AB测试（Prompt优化时用）
python tests/integration/run_ab_test.py \
  --variant-a '{"name":"版本A"}' \
  --variant-b '{"name":"版本B"}' \
  --limit 20

# 查看报告
cat tests/integration/reports/golden_*.txt
cat tests/integration/reports/ab_*.txt
```

---

## 💡 实际使用场景

### 场景1：修改代码后验证

```bash
# 1. 修改了代码
vim src/ai_engine.py

# 2. 快速验证（2分钟）
python tests/integration/run_golden_set.py --limit 10

# 3. 看结果
# 通过率>80% && 平均分>70 → ✅ 可以提交
# 否则 → ❌ 需要修复
```

### 场景2：优化Prompt

```bash
# 1. 准备两个Prompt版本
# 2. AB测试对比
python tests/integration/run_ab_test.py \
  --variant-a '{"name":"现有"}' \
  --variant-b '{"name":"优化"}' \
  --limit 20

# 3. 查看推荐
cat reports/ab_*.txt

# 4. 采用更优的版本
```

### 场景3：发布前检查

```bash
# 运行完整黄金测试集
python tests/integration/run_golden_set.py

# 标准：通过率≥90% 且 平均分≥80
# 达标 → 🚀 可以发布
# 不达标 → ⚠️ 需要修复
```

---

## 📈 如何看报告

### 控制台输出

```
================================================================================
[TC001] 简单记账-完整信息
================================================================================
📝 输入：今天买菜花了80元
🤖 AI回复：已记录您的支出：买菜80元，归入餐饮类目。
⏱️  耗时：7.23秒

📊 数据层验证中...  分数: 38.0/40  ← 数据存储准确
🧠 智能层评估中...  分数: 36.5/40  ← AI理解得好
✨ 体验层评估中...  分数: 17.0/20  ← 用户体验佳

================================================================================
✅ 测试通过 - 总分: 91.5/100 (等级A)  ← 总分和等级
================================================================================
```

### 最终总结

```
📊 测试总结
  总测试数: 10
  ✅ 通过: 9 (90.0%)    ← 通过率
  ❌ 失败: 1
  📈 平均分: 85.2/100   ← 平均分

平均分数:
  总分: 85.2/100
  数据层: 36.5/40
  智能层: 34.0/40
  体验层: 14.7/20
```

### JSON报告

```json
{
  "summary": {
    "pass_rate": 0.90,
    "avg_total_score": 85.2,
    ...
  },
  "test_scores": [...],
  "failed_cases": [...]
}
```

---

## 🎓 评分规则（简化版）

### 数据层（40分）- 自动评分

- ✅ 数据有存储 → 10分
- ✅ 金额准确 → 5分
- ✅ 类目正确 → 5分
- ✅ 时间合理 → 5分
- ✅ 结构完整 → 10分
- ✅ 无重复 → 5分

### 智能层（40分）- AI评分

- 意图理解 → 10分
- 信息提取 → 10分
- 上下文运用 → 10分
- 回复相关性 → 10分

### 体验层（20分）- AI评分

- 人设契合 → 5分
- 语言质量 → 5分
- 信息完整 → 5分
- 用户友好 → 5分

---

## 💰 成本参考

| 操作 | 用例数 | 时间 | 成本 |
|-----|--------|------|------|
| 快速验证 | 10 | 2分钟 | $0.35 |
| 完整测试 | 50 | 15分钟 | $1.65 |
| AB测试 | 30×2 | 12分钟 | $2.00 |

**月度预算**（假设）：
- 日常快速验证：20次 × $0.35 = $7
- 完整测试：4次 × $1.65 = $6.6
- AB测试：2次 × $2 = $4
- **总计：约$18/月**

---

## 🔧 问题排查

### Q: 测试失败怎么办？

1. **查看详细评分** - 哪一层分数低？
   - 数据层低 → AI没正确执行任务
   - 智能层低 → AI理解有问题
   - 体验层低 → 回复质量不佳

2. **查看具体问题**
   ```
   ⚠️  改进建议:
     1. 缺少金额字段
     2. 类目识别不准确
   ```

3. **针对性修复**
   - 修改Prompt
   - 调整AI逻辑
   - 重新测试

### Q: 为什么这么慢？

- 每个用例需要8-15秒（AI调用耗时）
- 50个用例需要10-15分钟
- **解决**：日常用`--limit 10`快速测试

### Q: 评分不稳定？

- AI评估有±1-2分随机波动（已设置低温度）
- **不用担心**：关注趋势，不关注单次绝对值
- **显著差异**：≥3分才认为是真正的差异

---

## 📚 深入学习

- **完整指南**：`TEST_SYSTEM_V2_GUIDE.md`
- **实现总结**：`V2_IMPLEMENTATION_SUMMARY.md`
- **黄金测试集**：`test_cases/golden_set.yaml`
- **代码示例**：`test_p0_accounting_v2.py`

---

## 🎉 开始使用

```bash
# 就这么简单！
python tests/integration/run_golden_set.py --limit 10
```

**2分钟后，你就能看到FAA的完整评分！**

---

**版本**: 2.0  
**更新**: 2025-10-10  
**状态**: ✅ 可用

