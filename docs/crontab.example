# FAA Crontab 示例
# 在服务器上运行：crontab -e
# 然后复制以下内容（根据需要调整路径）

# ============================================
# 健康检查 - 每 5 分钟
# ============================================
*/5 * * * * /opt/faa/scripts/health_check.sh >> /opt/faa/logs/cron.log 2>&1

# ============================================
# 日志监控 - 每小时（可选）
# ============================================
0 * * * * /opt/faa/scripts/log_monitor.sh >> /opt/faa/logs/cron.log 2>&1

# ============================================
# 完整备份（数据库 + 媒体文件）- 每天凌晨 2 点
# ============================================
#0 2 * * * /opt/faa/scripts/backup_volumes.sh >> /opt/faa/logs/cron.log 2>&1

# 或者只备份数据库（轻量）
0 2 * * * docker-compose -f /opt/faa/family-ai-assistant/docker-compose.yml exec -T postgres pg_dump -U faa family_assistant | gzip > /opt/faa/backups/db_$(date +\%Y\%m\%d).sql.gz 2>&1

# ============================================
# 清理旧备份 - 每周日凌晨 3 点（保留 30 天）
# ============================================
0 3 * * 0 find /opt/faa/backups -name "db_*.sql.gz" -mtime +30 -delete

# ============================================
# Docker 清理 - 每月 1 号凌晨 4 点
# ============================================
0 4 1 * * cd /opt/faa/family-ai-assistant && docker system prune -f >> /opt/faa/logs/cron.log 2>&1

# ============================================
# 磁盘空间监控 - 每天早上 8 点
# ============================================
0 8 * * * /opt/faa/scripts/disk_monitor.sh

# ============================================
# 媒体文件清理 - 每周日凌晨 4 点（可选）
# ============================================
# 清理 30 天前的临时文件
# 0 4 * * 0 docker-compose -f /opt/faa/family-ai-assistant/docker-compose.yml exec -T faa-api find /data/media/temp -type f -mtime +30 -delete 2>&1

# ============================================
# 注意事项
# ============================================
# 1. 确保所有脚本有执行权限：chmod +x /opt/faa/scripts/*.sh
# 2. 根据实际路径调整命令
# 3. 检查 cron 日志：tail -f /opt/faa/logs/cron.log
# 4. 如需 Threema 告警，设置环境变量：
#    THREEMA_BOT_ID=*YOUR_ID THREEMA_ADMIN_ID=YOUR_ID THREEMA_SECRET=secret
# 5. 备份脚本说明：
#    - backup_volumes.sh: 完整备份（数据库 + 媒体文件）
#    - restore_volumes.sh: 交互式恢复
#    - disk_monitor.sh: 磁盘空间监控和告警

